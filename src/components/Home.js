import bg from '../images/malware-bg.jpg'
import { Jumbotron} from "reactstrap";
import {Link} from "react-router-dom";
import React from 'react';
import axios from 'axios';
import {useState, useRef} from 'react';

export default function Home() {

    const [file, setFile] = useState(''); //storing the uploaded file
    const [data, getFile] = useState({name: "", path: ""}); //storing received file from backend
    const [progress, setProgress] = useState(0); //progress bar
    const el = useRef(); //accessing input element

    const handleChange= (e) => {
        setProgress(0);
        const file = e.target.files[0]; //accessing file
        console.log("FILEEE: ", file);
        setFile(file);
    }

    const uploadFile = () => {
        const formData = new FormData();
        formData.append('file', file); //appending file
        axios.post('http://localhost:3000/upload', formData, {
            onUploadProgress: (ProgressEvent) => {
                let progress = Math.round(
                    ProgressEvent.loaded / ProgressEvent.total *100
                ) + "%";
                setProgress(progress);
            }
        }).then(res => {
            console.log("RESPONSE: ", res);
            getFile({
                name: res.data.name,
                path:'http://localhost:3000' + res.data.path
            })
        }).catch(e => {
            console.log("ERROR: ", e);
        })
    }

    return (
        <div>
            <div className="home-container">
                {/* Background image*/}
                <img src={bg} className="w-100 position-absolute d-none d-sm-block" alt="malware" />

                {/* Jumbotron*/}
                <div className="container">

                    <div className="row mt-4 mb-5">
                        <div className="col">
                            <br/>
                        </div>

                    </div>
                    <div className="row">
                        <div className="col-lg-10 text-center offset-lg-1 ">
                            <Jumbotron>
                                {/*TITLE*/}
                                <b><h2>Welcome to Malware Lab.</h2></b>
                                <hr/>
                                {/* text to guide user */}
                                <div className="row text-center" >
                                    <div className="col">
                                        <p className="lead">Upload your file here.</p>
                                    </div>
                                </div>

                                {/*File input*/}
                                {/*<div className="row text-center" >*/}
                                {/*    <div className="col-6 center-inp">*/}
                                {/*        <Input type="file" ref={el} onChange={() => handleChange()} name="file" id="exampleFile" />*/}
                                {/*    </div>*/}
                                {/*</div>*/}

                                <input type="file" ref={el} onChange={handleChange} />

                                {/* progress bar*/}
                                <div className="progessBar" style={{ width: progress }}>
                                    {progress}
                                </div>

                                {/*choose type of analysis*/}
                                <div className="row text-center" >
                                    <div className="col">
                                    <p className="lead">Please choose which type of analysis you are interested in.</p>
                                    </div>
                                </div>
                                <div className="row text-center " >
                                    <div className="col center-inp">
                                    <div class="form-group">
                                        <select id="inputState" class="form-control">
                                            <option selected>Choose Type...</option>
                                            <option>Static</option>
                                            <option>Dynamic</option>
                                            <option>ML</option>
                                            <option>All</option>
                                        </select>
                                    </div>
                                    </div>
                                </div>

                                {/*Submit button*/}
                                <div className="row text-center mt-3" >
                                    <div className="col">
                                    <p>
                                        <Link to="/" className="btn btn-outline-success"><span onClick={uploadFile}>Submit</span></Link>
                                    </p>
                                    </div>
                                </div>

                            {/*    Display received image*/}
                            {data.path && <img src={data.path} alt={data.name} />}
                            </Jumbotron>
                        </div>

                    </div>
                </div>

            </div>

        </div>
    );
}
